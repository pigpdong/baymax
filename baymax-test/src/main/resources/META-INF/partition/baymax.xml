<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
	   http://www.springframework.org/schema/beans 
	   http://www.springframework.org/schema/beans/spring-beans-3.2.xsd" >

    <!-- 上下文配置 -->
	<bean id="baymaxRouteService" class="com.tongbanjie.baymax.support.BaymaxContext" init-method="init">
		<property name="tables">
			<list>
				<ref local="table_trade_order"/>
			</list>
		</property>
	</bean>

    <!-- 表配置 -->
    <bean id="table_trade_order" class="com.tongbanjie.baymax.router.strategy.PartitionTable">
        <property name="logicTableName"             value="t_order"/>
        <property name="namePatten"                 value="t_order_{0}"/>
        <property name="rule"                       ref  ="trade_order_rule"/>

        <!-- 目标数据源 -->
        <property name="nodeMapping">
            <bean class="com.tongbanjie.baymax.router.strategy.SimpleTableNodeMapping">
                <constructor-arg name="config">
                    <list>
                        <value>p1:0,1</value>
                        <value>p2:2,3</value>
                    </list>
                </constructor-arg>
            </bean>
        </property>

    </bean>

    <!-- 表的分区列 -->
    <bean name="trade_order_rule" class="com.tongbanjie.baymax.router.strategy.PartitionTableRule">
        <property name="columns">
            <list>
                <bean class="com.tongbanjie.baymax.router.strategy.PartitionColumn">
                    <property name="name"           value="user_id"/>
                    <property name="process"        ref="subRight1"/>
                </bean>
                <bean class="com.tongbanjie.baymax.router.strategy.PartitionColumn">
                    <property name="name"           value="order_id"/>
                    <property name="process"        ref="subRight1"/>
                </bean>
            </list>
        </property>
        <property name="function" ref="elfundcion"/>
    </bean>

    <!-- 表的分区函数 -->
    <bean name="elfundcion" class="com.tongbanjie.baymax.router.strategy.function.ELFunction">
        <property name="expression"     value="value"/>
    </bean>

    <!-- 列的转换函数 -->
    <bean name="subRight1" class="com.tongbanjie.baymax.support.column.SubRightColumnProcess">
        <property name="length" value="1"/>
    </bean>


    <bean name="VirtualPartitionTable" class="com.tongbanjie.baymax.router.strategy.function.VirtualModFunction128_8"/>

</beans>
